{{/* Find the content/data/index.md page, and create JSON with paths to each data file */}}
{{- $dataBundle := (site.GetPage "/data") -}}
{{- $dataFilesList := $dataBundle.Params.dataFiles -}}
{{- $goalsDataPath := "" -}}

{{/* Get the last file in the list */}}
{{- $lastDataFile := "" -}}
{{ $fileNames := slice }}
{{- range $name, $value := $dataFilesList -}}
  {{ $fileNames = $fileNames | append $name }}
{{- end -}}
{{- range last 1 $fileNames -}}
  {{- $lastDataFile = . -}}
{{- end -}}

{{/* Make the JSON */}}
{
  "goalIconsDirPath" : "{{- $dataBundle.Params.goalIconsDirPath -}}",
  "missingValueCode" : "{{- $dataBundle.Params.missingValueCode -}}",
  "dataPaths": {
    {{- range $name, $value := $dataFilesList -}}
      {{- $dataFile := $dataBundle.Resources.Match $value -}}
      {{- range first 1 $dataFile -}}
        "{{ $name }}": "{{ .Permalink }}"
        {{/* Don't add comma to last data item so JSON is valid */}}
        {{- if not (eq $name $lastDataFile) -}},{{- end -}}
        {{- if eq $name "goals" -}}
          {{- $goalsDataPath = .Permalink -}}
        {{- end -}}
      {{- end -}}
    {{- end -}}
  }
}
